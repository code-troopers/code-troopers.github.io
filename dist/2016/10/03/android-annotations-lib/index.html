<!doctype html>
<html lang="fr">
  <head>
  <title>Code-Troopers - Android Annotations : Abusez-en !</title>
  <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
    rel="stylesheet"
/>

  
  
    <link href="/main.css" rel="stylesheet">
  
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <base href="/">
	
	<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
	<link rel="icon" href="/favicon.ico">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#ff4400">
	<meta name="theme-color" content="#fff">

  
  <meta property="og:title" content="Android Annotations : Abusez-en !" />
<meta property="og:description" content="Dans le lot des supports librairies que propose Google pour le développement Android (principalement pour la compatibilité de certains composants sur des anciennes versions de l’OS) il y en a une qui de prime abord ne va pas beaucoup servir c’est support-annotations.
En effet cette librairie ne contient pas grand chose en terme de classes ni de méthodes. En revanche elle possède de nombreuses annotations (d’où son nom…​). Le comble c’est que presque toutes ces annotations sont définie en tant que @Retention(CLASS), c’est-à-dire qu’elles seront conservées lors la génération des fichiers ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2016/10/03/android-annotations-lib/" /><meta property="og:image" content="/img/gopher_moi.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2016-10-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-10-03T00:00:00+00:00" />


  
</head>
  <body class="sans-serif">

    <header>
    <nav>
        
            <a id="id-company" href="/">Code-Troopers</a>
        
            <a id="id-skills" href="#skills">Compétences</a>
        
            <a id="id-portfolio" href="#portfolio">Réalisations</a>
        
            <a id="id-casting" href="https://team.code-troopers.com">L&#39;équipe</a>
        
            <a id="id-blogs" href="/blog">Blog</a>
        
            <a id="id-contact" href="#contact">Contact</a>
        
    </nav>
</header>

    

<section id="blog">
    <div class="wrapper">
        <h1>
            Blog
        </h1>
    </div>

    <section id="article">
        <div class="wrapper">
            <article>
                
                <img src="/blog/../android-simple-banner.png">
                
                
                
                
                <div class="wrapper-content">
                    <h2>Android Annotations : Abusez-en !</h2>
                    
                    
                    <ul class="tags">
                        
                        <li><a href="/tags/android/">Android</a></li>
                        
                        <li><a href="/tags/xml/">XML</a></li>
                        
                        <li><a href="/tags/tools/">Tools</a></li>
                        
                        <li><a href="/tags/design/">Design</a></li>
                        
                    </ul>
                    
                    <div class="content">
                        <div class="paragraph">
<p>Dans le lot des <a href="https://developer.android.com/topic/libraries/support-library/index.html">supports librairies</a> que propose Google pour le développement Android (principalement pour la compatibilité de certains composants sur des anciennes versions de l’OS) il y en a une qui de prime abord ne va pas beaucoup servir c’est <code>support-annotations</code>.</p>
</div>
<div class="paragraph">
<p>En effet cette librairie ne contient pas grand chose en terme de classes ni de <a href="http://www.methodscount.com/?lib=com.android.support%3Asupport-annotations%3A24.2.1">méthodes</a>. En revanche elle possède de nombreuses annotations (d’où son nom…​). Le comble c’est que presque toutes ces annotations sont définie en tant que <code>@Retention(CLASS)</code>, c’est-à-dire qu’elles seront conservées lors la génération des fichiers <em>.classes</em> mais n’auront pas d’impact au moment de l’execution du code`.<br/>
À quoi peuvent-elles servir ? Et bien c’est le propre des annotations, elles servent à apporter des informations sur des portions de code et éventuellement donner quelques instructions au compilateur. L’un des exemples le plus connu est <em>@Deprecated</em> que vous devez cotoyer tous les jours. Cette annotation a pour seul but d’informer le développeur qu’il est fortement déconseillé d’utiliser cette méthode.</p>
</div>
<div class="paragraph">
<p>L’avantage d’utiliser les <code>support-annotations</code> est qu’Android Studio connait leur signification et donc va pouvoir highlighter des portions de code en rapport avec celles-ci lorsqu’un comportement attendu n’est pas respecté.</p>
</div>
<div class="paragraph">
<p>Faisons un petit tour des <a href="https://developer.android.com/reference/android/support/annotation/package-summary.html">annotations présentes dans <code>support-annotations</code></a> et de leur intégration dans Android Studio</p>
</div>
<div class="sect1">
<h2 id="_nullable_nonnull">@Nullable / @NonNull</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le couple d’annotations le plus connu est probablement @Nullable et @NonNull, car déjà présent depuis un certain temps dans différents packages comme <a href="https://www.jetbrains.com/help/idea/2016.2/nullable-and-notnull-annotations.html">Intellij</a> ou <a href="http://mvnrepository.com/artifact/javax.annotation/javax.annotation-api/1.3">javax.annotations</a>.</p>
</div>
<div class="paragraph">
<p>Annoter une méthode @Nullable permet d’indiquer que le retour de celle-ci peut être <em>null</em> et donc qu’il est fort préférable de procéder à un null check avant d’utiliser l’objet retourné. Le @NonNull permet lui d’assurer que le résultat est toujours un objet valide.</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_nullable.png" data-lightbox="1" title="Warning sur un retour @Nullable">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_nullable_min.png" alt="Warning sur un retour @Nullable"/>
</a>
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_notnull.png" data-lightbox="1" title="Warning sur une methode @NonNull">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_notnull_min.png" alt="Warning sur une methode @NonNull"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anyres">@&lt;Any&gt;Res</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le groupe d’annotations suivant est probablement celui que j’utilise le plus souvent est le <code>@…​Res</code>.</p>
</div>
<div class="paragraph">
<p>Et oui étant donné que toutes les références des ressources sont des <code>int</code> lorsqu’elles sont générées dans votre class <em>R</em> il est difficile de les différencier lorsqu’on en passe une en paramètre de méthode.
Et bien avec un <code>@ColorRes int myColor</code>, Android Studio s’occupera de vous avertir si la valeur passée ne correspond pas à une ressource du type <code>color</code>.</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_stringres.png" data-lightbox="1" title="Warning sur un paramètre @StringRes">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_stringres_min.png" alt="Warning sur un paramètre @StringRes"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="paragraph">
<p>La liste (non complète) des ressources que vous pouvez contrôler :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ColorRes</code></p>
</li>
<li>
<p><code>DimenRes</code></p>
</li>
<li>
<p><code>DrawableRes</code></p>
</li>
<li>
<p><code>IdRes</code></p>
</li>
<li>
<p><code>StringRes</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_callsuper">@CallSuper</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je l’ai découverte récemment et je trouve qu’elle est d’une grande aide. Étant donné l’importance du cycle de vie de chaque élément dans Android
il est indispensble de s’assurer que chaque méthode est appelée au bon moment.
Et lorsque qu’il y a un peu de refactor il arrive vite d’oublier d’appeler le super d’une méthode surchargée. Maintenant vous en serez averti !</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_callsuper.png" data-lightbox="1" title="Warning sur un appel super manquant">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_callsuper_min.png" alt="Warning sur un appel super manquant"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirepermission">@RequirePermission</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour être sur de ne pas oublier une permission dans le <code>manifest.xml</code> cette annotation permettra (sur une classe ou une méthode) de vous rappeler explicitement quelles sont celles dont vous avez besoin.</p>
</div>
<div class="paragraph">
<p>On peut d’ailleurs voir le warning d’Android Studio en créant un sample project et en démarrant une nouvelle activity avec un <code>Intent.ACTION_CALL</code>.</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_permission.png" data-lightbox="1" title="Warning sur une permission manquante">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_permission_min.png" alt="Warning sur une permission manquante"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stringdef">@StringDef</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lorsque l’on dev pour Android on doit savoir que <a href="https://www.youtube.com/watch?v=Hzs6OBcvNQE">les enums sont à proscrire</a> et du coup c’est embêtant, car c’est tout de même bien pratique.
La parade est donc de passer par une liste de constantes et de créer une nouvelle annotation qui limitera les valeurs attendues, comme ceci :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public final static String Constant.TROOPER_VINCENT = &#34;VM&#34;;
public final static String Constant.TROOPER_JORIS = &#34;JP&#34;;
public final static String Constant.TROOPER_BENJAMIN = &#34;BC&#34;;

@StringDef({
        Constant.TROOPER_VINCENT,
        Constant.TROOPER_JORIS,
        Constant.TROOPER_BENJAMIN,
})
@Retention(RetentionPolicy.SOURCE)
public @interface Trooper {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et ensuite d’utiliser cette annotation à chaque fois que seulement une des valeurs précédente est autorisée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void getProject(@Trooper String currentTrooper){}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Certes ce n’est pas aussi puissant qu’une enum, mais il faudra faire avec.</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_stringdef.png" data-lightbox="1" title="Warning sur un paramètre non attendu">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_stringdef_min.png" alt="Warning sur un paramètre non attendu"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="paragraph">
<p>Il est possible de faire la même chose pour une liste de <em>Integer</em> avec <code>@IntDef</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_range">@Range</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Toujours dans l’idée d’éviter de créer des énum @IntRange permettra de spécifier un peu plus ce qu’une méthode attend en paramètre.</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_range.png" data-lightbox="1" title="Warning sur un paramètre hors limites">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_range_min.png" alt="Warning sur un paramètre hors limites"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="paragraph">
<p>Une variante <code>@FloatRange</code> est aussi disponible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lint">Lint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comme chacune des erreurs n’empèche pas la compilation du projet, un bon moyen de surveiller qu’il n’y a pas de violation aux règles mises en place grâce à toutes ces annotations,
est de contrôler les rapports générés par lint</p>
</div>
<div class="paragraph">
<p></p><div style="text-align : center">
<a class="inlineBoxes" href="/images/posts/2016-09_AndroidAnnotations/android_annotations_lint.png" data-lightbox="1" title="Exemple de rapport lint">
        <img class="medium" src="/images/posts/2016-09_AndroidAnnotations/android_annotations_lint_min.png" alt="Exemple de rapport lint"/>
</a>
</div><p></p>
</div>
<div class="paragraph">
<p><br/></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lajouter_dans_son_projet">L’ajouter dans son projet</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    compile &#39;com.android.support:support-annotations:24.2.1&#39;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_liens">Liens</h3>
<div class="paragraph">
<p><a href="https://developer.android.com/topic/libraries/support-library/features.html#annotations" class="bare">https://developer.android.com/topic/libraries/support-library/features.html#annotations</a></p>
</div>
<div class="paragraph">
<p><a href="https://developer.android.com/studio/write/annotations.html" class="bare">https://developer.android.com/studio/write/annotations.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://developer.android.com/reference/android/support/annotation/package-summary.html" class="bare">https://developer.android.com/reference/android/support/annotation/package-summary.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/fchauveau/blog-android-annotations/tree/master/app/src/main/java/com/codetroopers" class="bare">https://github.com/fchauveau/blog-android-annotations/tree/master/app/src/main/java/com/codetroopers</a></p>
</div>
</div>
</div>
</div>

                    </div>
                    <div class="content-footer">
                        
                        <ul class="tags float">
                            
                            <li><a href="/tags/android/">Android</a></li>
                            
                            <li><a href="/tags/xml/">XML</a></li>
                            
                            <li><a href="/tags/tools/">Tools</a></li>
                            
                            <li><a href="/tags/design/">Design</a></li>
                            
                        </ul>
                        
                        <section id="author">
                            <div class="date">Rédigé par <span class="author-name">Florian</span></div>
                        </section>
                    </div>
                    <div class="share">
                        <span>Partager</span>
                        <ul class="socials">
                            <li>
                                <a target="_blank" title="Facebook"
                                   href="https://www.facebook.com/sharer.php?u=http://code-troopers.com%2f2016%2f10%2f03%2fandroid-annotations-lib%2f&t=Android%20Annotations%20%3a%20Abusez-en%20%21"
                                   class="facebook-button" rel="nofollow"
                                   onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;">
                                    <i class="ri-facebook-fill"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" title="Twitter"
                                   href="https://twitter.com/share?url=http://code-troopers.com%2f2016%2f10%2f03%2fandroid-annotations-lib%2f&text=Android%20Annotations%20%3a%20Abusez-en%20%21&via=codetroopers"
                                   rel="nofollow"
                                   onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;">
                                    <i class="ri-twitter-x-fill"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" title="Google +"
                                   href="https://plus.google.com/share?url=http://code-troopers.com%2f2016%2f10%2f03%2fandroid-annotations-lib%2f&hl=fr"
                                   class="google-button" rel="nofollow"
                                   onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;">
                                    <i class="fa fa-google-plus"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div style="clear:both"></div>


                    <div class="back">
                        <div class="pagination">
                            
                            <a href="/2016/12/21/stages-2017/" class="previous-page">
                                <div class="arrow"><div class="arrow_box_left arrow_box">
</div></div>
                                Article précédent
                            </a>
                            
                            
                            <a href="/2016/07/07/mame/" class="next-page">
                                Article suivant
                                <div class="arrow"><div class="arrow_box_right arrow_box">
</div></div>
                            </a>
                            
                        </div>
                    </div>

                    <section id="menu">
                        <ul>
                            
                        </ul>
                    </section>

                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                         
                        var disqus_shortname = 'codetroopers' 
                        var disqus_url = window.location.href
                        if (window.location.protocol != 'http:') {
                            disqus_url = 'http:' + window.location.href.substring(window.location.protocol.length)
                        }

                         
                        (function () {
                            var dsq = document.createElement('script')
                            dsq.type = 'text/javascript'
                            dsq.async = true
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq)
                        })()
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments
                        powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span
                            class="logo-disqus">Disqus</span></a>
                </div>
            </article>
        </div>
    </section>
</section>


    <section id="contact">
    <h1>Contact</h1>
    <div>
        <div>
            <img src="/img/legos_contact.jpg" alt="legos" width="100%" height="100%">
        </div>
        <div>
            <h2>Code-Troopers</h2>
            <p>
                26 bis rue Abraham Bosse<br>
                37000 Tours - Fr
            </p>
            <p>
                <a href="mailto:contact@code-troopers.com">contact@code-troopers.com</a>
            </p>
            <p>
                <a class="button" href="tel:+33782287216">07 82 28 72 16</a>
            </p>
        </div>
    </div>

    <h1>Suivez nos actualités</h1>

    <ul class="flex">
        <li>
            <a href="https://facebook.com/codetroopers37">
                <i class="ri-facebook-fill ri-3x"></i>
            </a>
        </li>
        <li>
            <a href="https://twitter.com/codetroopers">
                <i class="ri-twitter-x-fill ri-3x"></i>
            </a>
        </li>
        <li>
            <a href="https://github.com/code-troopers">
                <i class="ri-github-fill ri-3x"></i>
            </a>
        </li>
    </ul>
</section>

<footer>
    <div class="wrapper">
        <a href="#top" class="scroll-to-top">
            <img class="arrow" src="/img/arrow.png" alt="arrow">
        </a>
        <img src="/img/footer_logo.png" alt="logo">
        <div>
            <span>©2014 — 2024 Code-Troopers | <a href="/legals.html">Mentions légales</a></span>
            <span>Design : <a href="https://www.descheval.com/">descheval.com</a> | Développement : Code-Troopers</span>
        </div>
    </div>
</footer>

    
    
      <script src="/main.js"></script>
    
  </body>
</html>
